<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>::Sistem Informasi STMIK Time::</title>
    <h:outputStylesheet library="css" name="primeflex.min.css"/>
    <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>
</h:head>
<h:body>
    <ui:composition>
        <p:dialog modal="true" appendTo="@(body)" header="Skedul" resizable="true" maximizable="true"
                  widgetVar="dialog_skedul" fitViewport="true" style="min-width: 800px" styleClass="overflow-y-scroll">
            <h:form id="form_skedul">
                <p:outputPanel id="panel_skedul" styleClass="overflow-y-auto">
                    <p:panelGrid columns="3" columnClasses="ui-grid-col-8 p-0 pr-1,ui-grid-col-2 p-0 pr-1,ui-grid-col-2 p-0 text-right"
                                 styleClass="mb-1" layout="grid">
                        <p:selectOneMenu id="sel_kelas" value="#{skedulBean.selectedKelas.kodeKelas}"
                                         filter="true" filterMatchMode="contains" styleClass="w-full" required="true"
                                         requiredMessage="Pilih kelas!">
                            <f:selectItem itemValue="#{null}" itemLabel="Pilih kelas" itemDisabled="true"/>
                            <f:selectItems value="#{kelasBean.findAllKelas()}" var="kelas" itemLabel="#{kelas.namaKelas}"
                                           itemValue="#{kelas.kodeKelas}"/>
                            <p:ajax listener="#{skedulBean.lihatSkedul()}" event="valueChange" update="dt_skedul"/>
                        </p:selectOneMenu>
                        <p:commandButton id="btn_tambah" value="Tambah" icon="pi pi-plus"
                                         styleClass="ui-button-success" update="dt_skedul :form_messages:messages"
                                         process="@this sel_kelas" action="#{skedulBean.tambah()}"/>
                        <p:commandButton value="Simpan" icon="pi pi-save" action="#{skedulBean.simpan()}"
                                         process="@this dt_skedul:sel_matkul dt_skedul:sel_dosen dt_skedul:txt_keterangan" update=":form_messages:messages"/>
                    </p:panelGrid>
                    <!--<p:dataTable id="dt_skedul" value="#{skedulBean.skedulList}" var="skedul"
                                 stripedRows="true" tableStyle="table-layout:auto" rowIndexVar="rowidx">-->
                    <p:dataTable id="dt_skedul" value="#{skedulBean.skedulList}" var="skedul"
                                 stripedRows="true" tableStyle="table-layout:auto" rowIndexVar="rowidx">
                        <p:column headerText="No" styleClass="p-1 m-0">
                            <p:outputLabel value="#{rowidx+1}"/>
                        </p:column>

                        <p:column headerText="Kelas" styleClass="p-1 m-0">
                            <p:outputLabel value="#{skedul.kodeKelas.namaKelas}"/>
                        </p:column>

                        <p:column headerText="Mata Kuliah" styleClass="p-1 m-0">
                            <p:selectOneMenu id="sel_matkul" value="#{skedul.idMatakuliah.id}"
                                             filter="true" filterMatchMode="contains" styleClass="w-2rem"
                                             required="true" requiredMessage="Pilih matakuliah!" >
                                <f:selectItem itemValue="#{null}" itemLabel="Pilih matakuliah"
                                              itemDisabled="true"/>
                                <f:selectItems value="#{mataKuliahBean.findAllMataKuliah()}" var="matkul" itemDescription="#{matkul.kodeMatakuliah}"
                                               itemLabel="#{matkul.namaMatakuliah}" itemValue="#{matkul.id}"/>
                                <p:ajax process="@this" listener="#{skedulBean.statusRowEdit(skedul)}" update="lbl_kodematkul"/>
                            </p:selectOneMenu>
                        </p:column>
                        <p:column headerText="Kode Matkul" styleClass="p-1 m-0">
                            <p:outputLabel id="lbl_kodematkul" value="#{skedul.idMatakuliah.kodeMatakuliah}"/>
                        </p:column>
                        <p:column headerText="Dosen" styleClass="p-1 m-0">
                            <p:selectOneMenu  id="sel_dosen" value="#{skedul.idDosen.id}" filter="true" filterMatchMode="contains">
                                <f:selectItem itemValue="#{null}" itemLabel="Pilih dosen"
                                              itemDisabled="true"/>
                                <f:selectItems value="#{dosenBean.findAllDosen()}" var="dosen" itemLabel="#{dosen.namaDosen}"
                                               itemValue="#{dosen.id}"/>
                                <p:ajax process="@this" listener="#{skedulBean.statusRowEdit(skedul)}"/>
                            </p:selectOneMenu>
                        </p:column>

                        <p:column headerText="Keterangan" styleClass="p-1 m-0">
                            <p:inputText id="txt_keterangan" value="#{skedul.keterangan}" styleClass="w-full">
                                <p:ajax process="@this" listener="#{skedulBean.statusRowEdit(skedul)}"/>
                            </p:inputText>
                        </p:column>

                        <p:column headerText="Aksi" styleClass="m-0 p-1">
                            <p:commandButton icon="pi pi-minus" styleClass="ui-button-danger rounded-button"
                                             update="dt_skedul" action="#{skedulBean.hapusSkedul(skedul)}" process="@this">
                                    <p:confirm header="Konfirmasi" message="Hapus skedul?" icon="pi pi-info-circle"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    <p:confirmDialog global="true">
                        <p:commandButton value="No" type="button" styleClass="ui-button-flat ui-confirmdialog-no"/>
                        <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes"/>
                    </p:confirmDialog>
                </p:outputPanel>
            </h:form>
        </p:dialog>
    </ui:composition>
</h:body>
</html>
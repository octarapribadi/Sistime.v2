<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>::Sistem Informasi STMIK Time::</title>
    <h:outputStylesheet library="css" name="primeflex.min.css"/>
    <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>
</h:head>
<h:body>
    <h:form id="form_messages">
        <p:growl id="messages" showDetail="true" showSummary="true"/>
    </h:form>
    <div id="container-luar" class="fixed w-full h-full top-0 left-0">
        <div id="container-dalam" class="flex bg-white h-full w-full">
            <div id="container-navigator" class="bg-cover m-1 w-15rem border-round shadow-4">
                <!--sidebar disini-->
                <ui:insert name="sidebar">
                    <ui:include src="/admin/templates/sidebar.xhtml"/>
                </ui:insert>
            </div>
            <div id="container-main" class="flex flex-column bg-white w-full m-1">
                <div id="container-header"
                     class="flex bg-blue-200 align-items-center pl-2 h-4rem mb-1 border-round shadow-4">
                    <!--Header disini-->
                    <ui:insert>
                        <ui:include src="/admin/templates/header.xhtml"/>
                    </ui:insert>
                </div>
                <div id="container-content"
                     class="flex flex-column flex-wrap bg-white p-2 h-full overflow-y-auto shadow-4 border-round">
                    <!--content disini-->
                    <h:form id="form_datamahasiswa">
                        <p:remoteCommand action="#{mahasiswaBean.findAllMahasiswa()}"
                                         update="tbl_mahasiswa" autoRun="true"/>
                        <p:remoteCommand action="#{agamaBean.findAllAgama()}"
                                         update="form_editmahasiswa" autoRun="true"/>
                        <p:remoteCommand action="#{waktuKuliahBean.findAllWaktuKuliah()}"
                                         update="form_editmahasiswa" autoRun="true"/>
                        <p:remoteCommand action="#{sekolahBean.findAllSekolah()}" autoRun="true"/>
                        <p:dataTable id="tbl_mahasiswa" value="#{mahasiswaBean.mahasiswas}" widgetVar="wmhs"
                                     var="mhs" rowIndexVar="idx" selection="#{mahasiswaBean.selectedMahasiswa}"
                                     rowKey="#{mhs.idPendaftaran}"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks}
                                        {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                                     rowsPerPageTemplate="5,10,25,50,100,250,500,{ShowAll|'All'}"
                                     paginatorPosition="bottom" paginator="true" reflow="true"
                                     stripedRows="true" rows="25" selectionMode="single" sortMode="single"
                                     globalFilterOnly="true" filteredValue="#{mahasiswaBean.filteredMahasiswa}">
                            <f:facet name="header">
                                <div class="flex justify-content-between align-items-center">
                                    <p:outputLabel value="Tabel Mahasiswa" styleClass="font-bold align-content-center"/>

                                    <div>

                                        <p:commandButton value="Export" icon="pi pi-file-excel" styleClass="mr-1 ui-button-warning"
                                            >
                                            <p:dataExporter type="xls" target="tbl_mahasiswa" fileName="mahasiswa"/>
                                        </p:commandButton>

                                        <p:commandButton id="btn_kolom" type="button"
                                                         value="Kolom" icon="pi pi-align-justify"/>
                                        <p:columnToggler trigger="btn_kolom" datasource="tbl_mahasiswa"/>

                                        <span class="icon ui-input-icon-left">
                                        <i class="pi pi-search"/>
                                        <p:inputText id="globalFilter" placeholder="Search"
                                                     onkeyup="PF('wmhs').filter()"/>
                                        </span>
                                    </div>

                                </div>
                            </f:facet>
                            <p:column headerText="UserId" styleClass="p-1 w-5rem"
                                      sortBy="#{mhs.user.id}">
                                <h:outputText value="#{mhs.user.id}"/>
                            </p:column>

                            <p:column headerText="Tgl. Registrasi" styleClass="p-1 w-10rem"
                                      sortBy="#{mhs.tanggalPendaftaran}">
                                <h:outputText value="#{mhs.tanggalPendaftaran==null?'null':mhs.tanggalPendaftaran}">
                                    <f:convertDateTime pattern="dd-MMM-yyyy"/>
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Username" styleClass="p-1 w-15rem"
                                      sortBy="#{mhs.user.username}"
                                      filterBy="#{mhs.user.username}">
                                <h:outputText value="#{mhs.user.username}"/>
                            </p:column>

                            <p:column headerText="Nama Mahasiswa" styleClass="p-1"
                                      sortBy="#{mhs.namaMahasiswa}"
                                      filterBy="#{mhs.namaMahasiswa}">
                                <h:outputText value="#{mhs.namaMahasiswa}"/>
                            </p:column>

                            <p:column headerText="Email" styleClass="p-1"
                                      sortBy="#{mhs.email}"
                                      filterBy="#{mhs.email}">
                                <h:outputText value="#{mhs.email}"/>
                            </p:column>

                            <p:column headerText="Proses" styleClass="p-1 text-center w-5rem">
                                <p:commandButton icon="pi pi-user-edit" styleClass="ui-button-success rounded-button"
                                                 oncomplete="PF('dialog_editmahasiswa').show()"
                                                 update=":form_editmahasiswa"
                                                 action="#{mahasiswaBean.edit()}">
                                    <f:setPropertyActionListener target="#{mahasiswaBean.selectedMahasiswa}"
                                                                 value="#{mhs}"/>
                                </p:commandButton>
                                <p:commandButton icon="pi pi-print" styleClass="rounded-button ml-1"
                                                 actionListener="#{gambarProfilBean.findPpUser(mhs.user.id)}"
                                                 oncomplete="PF('dialog_print').show()"
                                                 update=":form_printmahasiswa:outputpanel_printmahasiswa">
                                    <f:setPropertyActionListener target="#{mahasiswa2Bean.selectedMahasiswa}"
                                                                 value="#{mhs}"/>
                                </p:commandButton>
                            </p:column>

                        </p:dataTable>
                    </h:form>

                    <p:dialog header="Print Mahasiswa" showEffect="fade" modal="true" appendTo="@(body)"
                              responsive="true" widgetVar="dialog_print" fitViewport="true"
                              resizable="true" style="min-width: 500px">
                        <ui:insert name="form_print">
                            <ui:include src="/admin/master-data/print_mahasiswa.xhtml"/>
                        </ui:insert>
                    </p:dialog>

                    <p:dialog header="Edit Mahasiswa" showEffect="fade" modal="true" appendTo="@(body)"
                              responsive="true" widgetVar="dialog_editmahasiswa" fitViewport="true"
                              maximizable="true" resizable="true">
                        <h:form id="form_editmahasiswa">
                            <p:panelGrid columns="2" layout="flex" columnClasses="col-4 p-1,col-8 p-1"
                                         styleClass="p-3">
                                <p:outputLabel for="@next" value="Nama Mahasiswa"/>
                                <p:inputText id="txt_nama" value="#{mahasiswaBean.selectedMahasiswa.namaMahasiswa}"
                                             styleClass="w-full"/>

                                <p:outputLabel for="@next">Program Studi</p:outputLabel>
                                <p:selectOneButton id="select_programstudi" required="true" styleClass="w-full"
                                                   requiredMessage="Pilih program studi!"
                                                   value="#{mahasiswaBean.selectedMahasiswa.programStudi.kodeProgramstudi}">
                                    <f:selectItems value="#{programStudiBean.listProgramStudi()}"
                                                   var="ps"
                                                   itemLabel="#{ps.namaProgramstudi}"
                                                   itemValue="#{ps.kodeProgramstudi}"/>
                                </p:selectOneButton>

                                <p:outputLabel for="@next" value="Angkatan"/>
                                <p:inputNumber id="txt_angkatan" value="#{mahasiswaBean.selectedMahasiswa.tahunAngkatan}"
                                               styleClass="w-full"
                                               decimalPlaces="0" decimalSeparator="" thousandSeparator=""
                                               minValue="2000" maxValue="2100"/>

                                <p:outputLabel for="@next" value="Email"/>
                                <p:inputText id="txt_email" type="email"
                                             value="#{mahasiswaBean.selectedMahasiswa.email}"
                                             styleClass="w-full"/>

                                <p:outputLabel for="@next">Kampus</p:outputLabel>
                                <p:selectOneButton id="select_kampus" required="true"
                                                   requiredMessage="Pilih kampus!"
                                                   value="#{mahasiswaBean.selectedMahasiswa.kampus.kodeKampus}">
                                    <p:ajax update="menu_waktukuliah"
                                            listener="#{waktuKuliahBean.getWaktuKuliahByKampus(mahasiswaBean.selectedMahasiswa.kampus.kodeKampus)}"/>
                                    <f:selectItems value="#{kampusBean.findAllKampus()}"
                                                   var="kampus"
                                                   itemLabel="#{kampus.kodeKampus}"
                                                   itemValue="#{kampus.kodeKampus}">
                                    </f:selectItems>
                                </p:selectOneButton>

                                <p:outputLabel for="@next">Waktu Kuliah</p:outputLabel>
                                <p:selectOneMenu id="menu_waktukuliah" requiredMessage="Pilih waktu kuliah!"
                                                 value="#{mahasiswaBean.selectedMahasiswa.waktuKuliah.idWaktukuliah==null?null:mahasiswaBean.selectedMahasiswa.waktuKuliah.idWaktukuliah}">
                                    <f:selectItem itemLabel="--pilih waktu kuliah--" itemValue="#{null}"/>
                                    <f:selectItems value="#{waktuKuliahBean.waktuKuliahs}" var="waktu"
                                                   itemValue="#{waktu.idWaktukuliah}"
                                                   itemLabel="#{waktu.keterangan}"/>
                                </p:selectOneMenu>

                                <p:outputLabel for="@next">Tempat Lahir</p:outputLabel>
                                <p:inputText value="#{mahasiswaBean.selectedMahasiswa.tempatLahir}"
                                             id="txt_tempatlahir" styleClass="w-full"/>

                                <p:outputLabel for="@next">Tanggal Lahir</p:outputLabel>
                                <p:datePicker id="dt_tanggallahir" showIcon="true" monthNavigator="true"
                                              yearNavigator="true" styleClass="w-full"
                                              value="#{mahasiswaBean.selectedMahasiswa.tanggalLahir}"
                                              yearRange="1980:2020"/>

                                <p:outputLabel for="@next">Jenis Kelamin</p:outputLabel>
                                <p:selectOneRadio id="rb_jk"
                                                  value="#{mahasiswaBean.selectedMahasiswa.jenisKelamin}">
                                    <f:selectItem itemLabel="Pria" itemValue="P"/>
                                    <f:selectItem itemLabel="Wanita" itemValue="W"/>
                                </p:selectOneRadio>

                                <p:outputLabel for="@next">Agama</p:outputLabel>
                                <p:selectOneMenu id="menu_agama" styleClass="w-full"
                                                 value="#{mahasiswaBean.selectedMahasiswa.agama.idAgama}">
                                    <f:selectItem itemLabel="---PILIH AGAMA---" itemValue="#{null}"/>
                                    <f:selectItems value="#{agamaBean.agamas}" var="agama"
                                                   itemLabel="#{agama.agama}" itemValue="#{agama.idAgama}"/>
                                </p:selectOneMenu>

                                <p:outputLabel value="Status:" for="@next"/>
                                <p:selectOneMenu id="menu_status" styleClass="w-full"
                                                 value="#{not empty mahasiswaBean.selectedMahasiswa.status.idStatus?mahasiswaBean.selectedMahasiswa.status.idStatus:-1}">
                                    <f:selectItem itemLabel="--Pilih Status--" itemValue="-1"/>
                                    <f:selectItems value="#{statusBean.findAllStatus()}" var="status"
                                                   itemLabel="#{status.status}" itemValue="#{status.idStatus}"/>
                                </p:selectOneMenu>

                                <p:outputLabel value="Golongan Darah:" for="@next"/>
                                <p:selectOneMenu id="menu_golongandarah"
                                                 value="#{mahasiswaBean.selectedMahasiswa.golonganDarah}">
                                    <f:selectItem itemLabel="A" itemValue="A"/>
                                    <f:selectItem itemLabel="B" itemValue="B"/>
                                    <f:selectItem itemLabel="AB" itemValue="AB"/>
                                    <f:selectItem itemLabel="O" itemValue="O"/>
                                </p:selectOneMenu>

                                <p:outputLabel value="Kewarganegaraan:" for="@next"/>
                                <p:inputText id="txt_kewarganegaraan"
                                             value="#{mahasiswaBean.selectedMahasiswa.kewarganegaraan}"/>

                                <p:outputLabel value="Alamat:" for="@next"/>
                                <p:inputTextarea value="#{mahasiswaBean.selectedMahasiswa.alamatMahasiswa}"
                                                 id="txt_alamat" maxlength="255" styleClass="w-full"
                                                 autoResize="false"/>

                                <p:outputLabel value="No. Telepon:" for="@next"/>
                                <p:inputMask id="txt_telepon" styleClass="w-full"
                                             value="#{mahasiswaBean.selectedMahasiswa.noTeleponMahasiswa}"
                                             mask="9999999999[9999]"/>

                                <p:outputLabel value="Jumlah Saudara:" for="@next"/>
                                <p:inputNumber id="txt_jumlahsaudara" styleClass="w-full"
                                               value="#{mahasiswaBean.selectedMahasiswa.jumlahSaudara}"
                                               decimalPlaces="0"/>

                                <p:outputLabel value="Anak ke-" for="@next"/>
                                <p:inputNumber id="txt_anakke" styleClass="w-full"
                                               value="#{mahasiswaBean.selectedMahasiswa.anakKe}"
                                               minValue="1" decimalPlaces="0"/>

                                <p:outputLabel value="Hobi:" for="@next"/>
                                <p:inputTextarea id="txt_hobi" value="#{mahasiswaBean.selectedMahasiswa.hobi}"
                                                 styleClass="w-full"
                                                 placeholder="Pisahkan dengan tanda koma ','"/>

                                <p:outputLabel value="Nama Ayah:" for="@next"/>
                                <p:inputText id="txt_namaayah" styleClass="w-full"
                                             value="#{mahasiswaBean.selectedMahasiswa.namaAyah}"/>

                                <p:outputLabel value="Nama Ibu:" for="@next"/>
                                <p:inputText id="txt_namaibu" value="#{mahasiswaBean.selectedMahasiswa.namaIbu}"
                                             styleClass="w-full"/>

                                <p:outputLabel value="Pekerjaan Orang Tua:" for="@next"/>
                                <p:inputTextarea id="txt_pekerjaanorangtua" styleClass="w-full"
                                                 value="#{mahasiswaBean.selectedMahasiswa.pekerjaanOrangtua}"
                                                 autoResize="false"/>

                                <p:outputLabel value="Pendidikan Orang Tua:" for="@next"/>
                                <p:inputText id="txt_pendidikanorangtua" styleClass="w-full"
                                             value="#{mahasiswaBean.selectedMahasiswa.pendidikanOrangtua}"
                                             placeholder="SD / SMP / SMA / SMK / D1 / D3 / S1"
                                />

                                <p:outputLabel value="Alamat Orang Tua:" for="@next"/>
                                <p:inputTextarea value="#{mahasiswaBean.selectedMahasiswa.alamatOrangtua}"
                                                 id="txt_alamatorangtua" styleClass="w-full"
                                                 autoResize="false"/>

                                <p:outputLabel value="No. Telepon Orang Tua:" for="@next"/>
                                <p:inputMask id="txt_teleponorangtua" styleClass="w-full"
                                             value="#{mahasiswaBean.selectedMahasiswa.noTeleponOrangtua}"
                                             mask="9999999999[9999]"/>

                                <p:outputLabel for="@next" value="Sekolah Asal:"/>
                                <p:autoComplete completeMethod="#{sekolahBean.complete}" var="sekolah"
                                                value="#{mahasiswaBean.selectedMahasiswa.sekolah}"
                                                itemLabel="#{sekolah.namaSekolah}" itemValue="#{sekolah}"
                                                converter="#{sekolahConverter}"
                                                styleClass="w-full" inputStyleClass="w-full" forceSelection="true"/>
                                <p:outputLabel for="@next" value="Jurusan:"/>
                                <p:inputText id="txt_jurusan" value="#{mahasiswaBean.selectedMahasiswa.jurusan}"
                                             styleClass="w-full"
                                             placeholder="ipa / ips / bahasa / kejuruan lainnya"/>

                                <p:outputLabel for="@next" value="Tahun Kelulusan:"/>
                                <p:inputNumber id="txt_tahunkelulusan" styleClass="w-full"
                                               value="#{mahasiswaBean.selectedMahasiswa.tahunLulus}"
                                               decimalPlaces="0" decimalSeparator="" thousandSeparator=""/>

                                <p:outputLabel for="@next" value="Nomor Ijazah:"/>
                                <p:inputText id="txt_ijazah" value="#{mahasiswaBean.selectedMahasiswa.noIjazah}"
                                             styleClass="w-full"/>

                                <p:outputLabel for="@next" value="Tanggal Ijazah:"/>
                                <p:datePicker id="dt_tanggalijazah" styleClass="w-full" showIcon="true"
                                              monthNavigator="true" yearNavigator="true"
                                              value="#{mahasiswaBean.selectedMahasiswa.tanggalIjazah}"/>

                                <p:outputLabel for="@next" value="Keterangan:"/>
                                <p:inputTextarea id="txt_keterangan"
                                                 value="#{mahasiswaBean.selectedMahasiswa.keterangan}"
                                                 styleClass="w-full" autoResize="false"/>

                                <p:outputLabel/>
                                <p:column>
                                    <p:commandButton id="btn_submit" value="Submit" action="#{mahasiswaBean.save()}"
                                                     styleClass="mr-2" oncomplete="PF('dialog_editmahasiswa').hide()"
                                                     icon="pi pi-save"
                                                     update=":form_messages:messages :form_datamahasiswa:tbl_mahasiswa @form"/>
                                </p:column>
                            </p:panelGrid>
                        </h:form>
                    </p:dialog>

                </div>
            </div>
        </div>
    </div>
</h:body>
</html>